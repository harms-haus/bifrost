{{if .Error}}
<div class="page-header">
  <h1>Account Not Found</h1>
</div>
<div class="card">
  <div class="card-body">
    <p class="text-muted">{{.Error}}</p>
    <a href="/admin/accounts" class="btn btn-primary">Back to Accounts</a>
  </div>
</div>
{{else}}
<div class="page-header">
  <h1>{{.Data.Account.Username}}</h1>
  <p class="text-muted">{{.Data.Account.AccountID}}</p>
</div>

<div class="card">
  <div class="card-header">
    <h2>Details</h2>
    <span class="badge badge-{{.Data.Account.Status}}">{{.Data.Account.Status}}</span>
  </div>
  <div class="card-body">
    <dl class="dl-horizontal">
      <dt>ID</dt>
      <dd><code>{{.Data.Account.AccountID}}</code></dd>
      <dt>Username</dt>
      <dd>{{.Data.Account.Username}}</dd>
      <dt>Status</dt>
      <dd>{{.Data.Account.Status}}</dd>
      <dt>PATs</dt>
      <dd>{{.Data.Account.PATCount}}</dd>
      <dt>Created</dt>
      <dd>{{.Data.Account.CreatedAt}}</dd>
    </dl>

    {{if and (eq .Data.Account.Status "active") (not .Data.IsSelf)}}
    <form method="post" action="/admin/accounts/{{.Data.Account.AccountID}}/suspend" class="form-inline mt-2">
      <input type="text" name="reason" placeholder="Reason for suspension (optional)" class="form-control">
      <button type="submit" class="btn btn-danger">Suspend Account</button>
    </form>
    {{end}}
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h2>Roles ({{len .Data.Account.Realms}})</h2>
  </div>
  <div class="card-body">
    {{if .Data.Account.Roles}}
    <table class="table">
      <thead>
        <tr>
          <th>Realm</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{range $realmID, $role := .Data.Account.Roles}}
        <tr>
          <td><a href="/admin/realms/{{$realmID}}">{{$realmID}}</a></td>
          <td><span class="badge badge-{{$role}}">{{$role}}</span></td>
          <td>
            {{if or (not $.Data.IsSelf) $.Account.IsAdmin}}
            <form method="post" action="/admin/accounts/{{$.Data.Account.AccountID}}/roles" class="form-inline" style="display:inline">
              <input type="hidden" name="realm_id" value="{{$realmID}}">
              <input type="hidden" name="action" value="revoke">
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Revoke this role from the account?')">Revoke</button>
            </form>
            {{end}}
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="text-muted">No roles assigned</p>
    {{end}}

    {{if or (not .Data.IsSelf) $.Account.IsAdmin}}
    <hr>
    <h3>Assign Role</h3>
    <form method="post" action="/admin/accounts/{{.Data.Account.AccountID}}/roles" class="form-inline">
      <div class="form-group">
        <label for="realm_id">Realm:</label>
        <select name="realm_id" id="realm_id" required>
          <option value="">Select realm...</option>
          {{range .Data.Realms}}
          <option value="{{.RealmID}}">{{.Name}} ({{.RealmID}})</option>
          {{end}}
        </select>
      </div>
      <div class="form-group">
        <label for="role">Role:</label>
        <select name="role" id="role" required>
          <option value="">Select role...</option>
          {{range .Data.ValidRoles}}
          <option value="{{.}}">{{.}}</option>
          {{end}}
        </select>
      </div>
      <input type="hidden" name="action" value="assign">
      <button type="submit" class="btn btn-primary">Assign</button>
    </form>
    {{end}}
  </div>
</div>

<a href="/admin/accounts" class="btn btn-secondary">Back to Accounts</a>
{{end}}
